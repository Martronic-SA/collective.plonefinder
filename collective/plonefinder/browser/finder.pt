
<metal:block use-macro="context/global_defines/macros/defines" />
<tal:headers define="request context/REQUEST">
  <tal:block define="charset site_properties/default_charset|string:utf-8;
                     dummy python:request.RESPONSE.setHeader('Content-Type', 'text/html;;charset=%s' % charset)" />
  <tal:block define="dummy python:request.RESPONSE.setHeader('Expires', 'Sat, 1 Jan 2000 00:00:00 GMT')" />
  <tal:block define="dummy python:request.RESPONSE.setHeader('Last-Modified', 'Sat, 1 Jan 2000 00:00:00 GMT')" />
  <tal:block define="dummy python:request.RESPONSE.setHeader('Cache-control', 'max-age=0,s-maxage=0,must-revalidate')" />
</tal:headers>
<metal:block tal:define="typeView view/typeview;
                         fieldName view/fieldname;                         
                         SearchableText request/SearchableText | string:;
                         onlybody request/form/onlybody       | python:False;
                         b_size python:50;
                         b_start python:0;
                         b_start request/b_start | b_start;                      
                         typecss view/typecss;
                         scope view/scope;
                         type string:;
                         browsed_url view/browsed_url;
                         ispopup view/ispopup;
                         portal view/portal;
                         portal_url view/portal_url;
                         "
             i18n:domain="collective.plonefinder">
             

  <tal:block condition="onlybody">             
    <metal:block define-macro="plone_browser_body">
                      
          <div id="plone-browser-menu">
            <a class="closeWindow"
               i18n:translate=""
               href="javascript: void(0);"
               onclick="Browser.close(); return false;">
            </a>
            <a class="maximize"
               i18n:translate=""
               href="javascript: void(0);"
               onclick="Browser.maximize(); return false;">
            </a>          
            <div id="searchBrowserBox">
              <form>
              <input name="SearchableText" 
                     id="searchTerm" 
                     type="text" 
                     value="" 
                     size="25" 
                     title="Search Site"
                     tabindex="0"
                     tal:attributes="value SearchableText" /> 
              <select name="scope" id="scope">
                <option value="portal"
                        i18n:translate="label_all_site">
                  all site
                </option>          
                <option value="folder"
                        i18n:translate="label_this_folder">
                  this folder
                </option>
              </select>
              <input class="searchBrowserButton" type="submit" value="Search"
                     i18n:domain="plone"
                     i18n:attributes="value label_search;"
                     href="javascript: void(0);"
                     tal:attributes="onclick string:Browser.search('$here_url', '${browsed_url}', '${type}', '${typeView}');; return false;" />
              </form>       
            </div>
            <div id="menuViews">
              <a href="javascript: void(0);"
                 onclick="Browser.setView('image'); return false;"
                 title="album view"
                 tal:attributes="class python:typeView=='image' and 'imageView selected' or 'imageView'"
                 i18n:attributes="title label_album_view;">
              </a>                  
              <a href="javascript: void(0);"
                 onclick="Browser.setView('file'); return false;"
                 title="file listing view"
                 tal:attributes="class python:typeView=='file' and 'fileView selected' or 'fileView'"
                 i18n:attributes="title label_file_listing_view;">
              </a>
            </div>
          </div>               
                 
          <div id="browser-crumbs"
               tal:condition="view/browse"
               tal:define="breadcrumbs view/finderBreadCrumbs;">      
              <a tal:condition="browsed_url"
                 tal:define="parentPath python:len(breadcrumbs)&gt;1 and breadcrumbs[-2]['absolute_url'] or ''"
                 class="folderUp"
                 href="javascript: void(0);"
                 tal:attributes="onclick string:Browser.update('${parentPath}', '','', '${b_start}');; return false;"
                 title="parent folder"
                 i18n:attributes="title">&nbsp;               
              </a>
              <span i18n:translate="you_are_here" i18n:domain="plone">You are here:</span>
              <span>
                  <a i18n:translate="tabs_home" i18n:domain="plone"
                     href="javascript: void(0);"
                     tal:attributes="onclick string:javascript:Browser.update('', '','', '${b_start}');; return false;">
                       Home
                  </a>
                  <span tal:condition="breadcrumbs" class="breadcrumbSeparator">
                      <tal:ltr condition="not: isRTL">&rarr;</tal:ltr> 
                      <tal:rtl condition="isRTL">&larr;</tal:rtl> 
                  </span>
                  <span tal:repeat="crumb breadcrumbs"
                        tal:attributes="dir python:isRTL and 'rtl' or 'ltr'">
                      <tal:last tal:define="is_last repeat/crumb/end">
                          <a href="javascript: void(0);"
                             tal:omit-tag="not: crumb/absolute_url"
                             tal:condition="python:not is_last"
                             tal:attributes="onclick string:Browser.update('${crumb/absolute_url}', '','', '${b_start}');; return false;"
                             tal:content="crumb/Title"
                             tal:on-error="crumb">
                              crumb
                          </a>
                          <span class="breadcrumbSeparator" tal:condition="not: is_last">
                              <tal:ltr condition="not: isRTL">&rarr;</tal:ltr>
                              <tal:rtl condition="isRTL">&larr;</tal:rtl>
                          </span>
                          <span tal:condition="is_last"
                                tal:content="crumb/Title">crumb</span>
                       </tal:last>
                  </span>
              </span>
          </div>
          
          <div id="plone-browser-body"
               tal:define="folders view/folders;
                           results view/results;                         
                           Batch python:modules['Products.CMFPlone'].Batch;
                           batch python:Batch(results, b_size, int(b_start), orphan=1);">
    
            <div metal:use-macro="here/batch_macros/macros/navigation" />
            <tal:folders repeat="f folders">
                <div tal:attributes="class string: ${typecss}Container folder;">
                     <a href="javascript: void(0);"
                        tal:attributes="onclick string:Browser.update('${f/url}', '','', '${b_start}');; return false;">
                        <div tal:attributes="class string:${typeView}Folder">
                          <img width="16"
                               height="16"
                               tal:define="icon f/thumb"
                               tal:attributes="class python:icon.split('/')[-1].replace('.','_');
                                               src icon" />
                        </div>
                        <div class="title"
                             tal:content="f/title">sample Folder 1</div>
                        <div class="legend"></div>
                     </a>
                     
                     <div class="relContainer" 
                          tal:condition="f/islinkable">
                       <a href="javascript: void(0);"
                          class="folderSelect"
                          i18n:attributes="title"
                          tal:attributes="onclick string:Browser.selectItem('${f/uid}');; return false;
                                          title   string:Select ${f/type};">
                          &nbsp;
                       </a>                   
                     </div>
                </div> 
            </tal:folders>
    
            <tal:results repeat="r batch">
              <div tal:attributes="class string:${typecss}Container ${r/orientation_class};">
                <a href="javascript: void(0);"
                   tal:attributes="class   r/container_class;
                                   title   string:select ${typeView};
                                   onclick string:Browser.selectItem('${r/uid}');; return false;" >
                  <img src="" tal:attributes="src r/thumb" />
                  <div class="title" tal:content="r/title">sample Portrait 1</div>
                  <div class="legend" tal:content="r/size">54 kB</div>
                </a>
  
                <div class="relContainer" tal:condition="r/is_image">
                  <a class="loupe thickbox"
                     tal:attributes="href r/preview_url;
                                     title string:${r/title} (preview);"
                     i18n:attributes="title">&nbsp;</a>                      
                </div>
              </div>
            </tal:results>            
            <tal:noresults condition="python: SearchableText and not results"
                           i18n:domain="plone">
                <div i18n:translate="description_no_results_found">No results were found.</div>
            </tal:noresults>
    
            <div style="clear: both;"></div>
          </div>  
    </metal:block>
  
  </tal:block>


    
  <metal:block define-macro="plone_browser"
               tal:condition="python: not (onlybody or ispopup)">
    <div id="plone-browser" class="popup">
      <div class="overlay"></div>
      <div class="window">
        <div class="browserRelativize">
          <div id="start-refresh"><!-- --></div>
              
          <metal:block use-macro="context/@@findermacros/macros/plone_browser_body" />
    
          <div class="statusBar">
            <div id="msg-loading">
              Loading please wait...
            </div>
            <div id="msg-done">
              Done.
            </div>
          </div>
    
          
          <div id="plone-browser-border-bottom"></div>
          <div id="plone-browser-border-top"></div>              
          <div id="plone-browser-corner-left"></div>      
          <div id="plone-browser-corner-resize"></div>      
          <div id="plone-browser-tab">
            <div id="plone-browser-tab-menu">         
              <span tal:content="python:here.utranslate('label_browse_server_%s' % fieldName, default='Browse server %s' % fieldName, domain='plonearticle')"
                    i18n:translate="">
                Browse server images
              </span>                            
            </div>
         
          </div>      
        </div>
      </div>
    </div>

  </metal:block>  
  
  <metal:block define-macro="plone_browser_popup"
               tal:condition="python: ispopup and not onlybody">
    <head>

      <tal:js define="scripts nocall:here/renderAllTheScripts|nothing">
        <!-- for Plone 2.5 launch js machinery + jquery -->
        <tal:block condition="nocall:scripts">
            <metal:block use-macro="scripts/macros/jsrenderer" />
            <script type="text/javascript"
                    tal:attributes="src string:$portal_url/++resource++plonefinder_static/jquery.js">
            </script>            
        </tal:block>
        <!-- for plone3 we just need htmlheader viewlet manager -->
        <tal:block condition="not:nocall:scripts"
                   replace="structure provider:plone.htmlhead" />             
      </tal:js>   
      
      <script type="text/javascript"
              tal:attributes="src string:$portal_url/++resource++plonefinder_static/finder.js">
      </script>

      <tal:css define="css nocall:here/renderAllTheStylesheets|nothing">
        <!-- for Plone 2.5 launch css machinery -->
        <tal:block condition="nocall:css">
            <metal:block use-macro="css/macros/cssrenderer" />
        </tal:block>
      </tal:css>
      
      <style type="text/css" media="all" 
             tal:content="string:@import url($portal_url/++resource++plonefinder_static/finder.css);">
      </style>


    
    </head>
    
    <body>  
    
      <input id="ispopup" type="hidden" value="1" />
      
      <div id="plone-browser" class="popup">
        <div class="window">
          <div class="browserRelativize">
            <div id="start-refresh"><!-- --></div>
      
            <metal:block use-macro="context/@@findermacros/macros/plone_browser_body" />
      
            <div class="statusBar">
              <div id="msg-loading">
                Loading please wait...
              </div>
              <div id="msg-done">
                Done.
              </div>
            </div>
      
            
            <div id="plone-browser-border-bottom"></div>
            <div id="plone-browser-border-top"></div>              
            <div id="plone-browser-corner-left"></div>      
            <div id="plone-browser-corner-resize"></div>      
            <div id="plone-browser-tab">
              <div id="plone-browser-tab-menu">         
                <span tal:content="python:here.utranslate('label_browse_server_%s' % fieldName, default='Browse server %s' % fieldName, domain='collective.plonefinder')"
                      i18n:translate="">
                  Browse server images
                </span>                            
              </div>
           
            </div>      
          </div>
        </div>
      </div>
      
    </body>

  </metal:block>    
  
  
</metal:block>  
